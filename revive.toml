ignoreGeneratedHeader = false
severity = "warning"
confidence = 0.8
errorCode = 0
warningCode = 0

# Turn everything on except rules we very explicitly decide we don't want
enableAllRules = true

##
# Rules which probably don't benefit this project, or which can't be configured
# enough to avoid false positives
##

[rule.add-constant]
  Disabled = true
[rule.argument-limit]
  Disabled = true
[rule.banned-characters]
  Disabled = true
[rule.bool-literal-in-expr]
  Disabled = true
[rule.cognitive-complexity]
  Disabled = true
[rule.cyclomatic]
  Disabled = true
[rule.use-errors-new]
  Disabled = true
[rule.file-header]
  Disabled = true
[rule.flag-parameter]
  Disabled = true
[rule.function-length]
  Disabled = true
[rule.function-result-limit]
  Disabled = true
[rule.get-return]
  Disabled = true
[rule.line-length-limit]
  Disabled = true
[rule.max-public-structs]
  Disabled = true
[rule.nested-structs]
  Disabled = true
[rule.package-comments]
  Disabled = true
[rule.unused-receiver]
  Disabled = true
[rule.redundant-test-main-exit]
  Disabled = true

##
# Questionable omissions: these would be great for us, but either can't be
# configured properly (yet) or show too many false positives to be worth
# digging through the noise. If possible we should look in the future at revive
# to see if it fixes the issues.
#
# DEVS: if you omit a rule that isn't completely unambiguously "meh", *explain
# your rationale*!
##

# I actually like this one, but it gets annoying digging through reports when
# there are functions built specifically to "die" on problems. panic() isn't
# the right answer in a call to logger.Fatalf or a CLI arg reading function.
[rule.deep-exit]
  Disabled = true

# This hurts my soul. Super useful in some cases (meaningless returns,
# unnecessary breaks, etc.), but it also bundles in single-element switch
# statements ("can be replaced by an if-then"), which can be really handy (easy
# to add a new case you know is going to happen, doing a very clear type
# switch, etc.) and have no extra cognitive load.
[rule.unnecessary-stmt]
  Disabled = true

# Same as above. Useful 80% of the time, wrong / questionable 20% of the time.
# There are cases where it's better to use the "wrong" function for consistency
# or changing things later.
[rule.unnecessary-format]
  Disabled = true

# Not all strings can be https. This rule is really stupid. It's unquestionably
# stupid, but looking just at the rule's *name*, it seems like it would have
# uses, but it just scans every string and yells at you for anything not
# "https". This obviously flags things over which you have no control.
[rule.unsecure-url-scheme]
  Disabled = true

# Another one that's too aggressive. Often we only want to catch some things
# and ignore the others (such as scanning the environment in a test).
[rule.enforce-switch-style]
  Disabled = true

##
# Rules we mostly like, but need to configure
##

# I don't love skipping some of these, but in most cases errors from various
# print statements don't matter, while errors from others (particularly
# io.Closer.Close and os.Remove) are rarely actionable or are happening as a
# result of something else already having gone wrong.
#
# I thought about adding SaveOp to this list, but I feel like it's too easy to
# accidentally rely on magicsql's error aggregation and then forget about it.
# This at least hits you with a warning if you forget to explicitly skip the
# error....
#
# Note that this is *not* a catch-all - there are outstanding bugs (see below)
# where this rule doesn't catch problems, and which we may have a lot of in our
# codebase. We need to check on this regularly (or if time permits try to help
# address the issue, though the descriptions suggest this is a very non-trivial
# fix) because unhandled errors are probably one of NCA's biggest weaknesses.
#
# Relevant issues:
#   - https://github.com/mgechev/revive/issues/350
#   - https://github.com/mgechev/revive/issues/582
[rule.unhandled-error]
  arguments =[
    "fmt\\.Print.*", "fmt\\.Fprint.*", "os\\.File\\.WriteString", "io\\.Closer\\.Close",
    "encoding/csv\\.Writer\\.Write", "os\\.Remove", "math/rand\\.Read"
  ]
